import React, { useState, useMemo } from 'react';

// --- Helper Components ---

// Icon for a checkmark
const CheckIcon = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5">
    <polyline points="20 6 9 17 4 12"></polyline>
  </svg>
);

// Icon for a radio button (empty)
const RadioIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-6 w-6">
        <circle cx="12" cy="12" r="10"></circle>
    </svg>
);

// Icon for a radio button (selected)
const RadioSelectedIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-6 w-6">
        <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path>
        <circle cx="12" cy="12" r="4" fill="currentColor"></circle>
    </svg>
);


// --- Main Survey Data ---
const surveyQuestions = [
  {
    id: 1,
    type: 'radio',
    question: 'When you hear "Artificial Intelligence (AI)," which word best describes your initial feeling?',
    options: ['Excited', 'Curious', 'Neutral', 'Cautious', 'Concerned'],
  },
  {
    id: 2,
    type: 'radio',
    question: 'How would you rate your own understanding of what AI is and how it works?',
    options: [
      'Beginner: It\'s a new concept for me.',
      'Familiar: I\'ve heard about it and know a few examples.',
      'Comfortable: I have a good grasp of the basics.',
      'Advanced: I could explain it to someone else.',
    ],
  },
  {
    id: 3,
    type: 'checkbox',
    question: 'Which of the following AI-powered tools have you used in the past month? (Check all that apply)',
    options: [
      'Navigation apps (e.g., Google Maps, Waze)',
      'Streaming recommendations (e.g., Netflix, YouTube)',
      'Smart home assistants (e.g., Alexa, Siri)',
      'Generative AI chatbots (e.g., ChatGPT, Gemini)',
      'AI image generators (e.g., Midjourney, DALL-E)',
      'None of the above',
    ],
  },
  {
    id: 4,
    type: 'radio',
    question: 'How often have you talked with your child about AI?',
    options: ['Frequently', 'Sometimes', 'Rarely', 'Never'],
  },
  {
    id: 5,
    type: 'text',
    question: 'When you think about your child using AI for school, what is your BIGGEST HOPE?',
    placeholder: 'e.g., creativity, future skills...',
  },
  {
    id: 6,
    type: 'text',
    question: 'And when you think about your child using AI for school, what is your BIGGEST CONCERN?',
    placeholder: 'e.g., cheating, privacy...',
  },
  {
    id: 7,
    type: 'radio',
    question: 'How confident do you feel in your ability to guide your child on using AI safely and responsibly?',
    options: [
      'Not at all confident',
      'A little confident',
      'Somewhat confident',
      'Very confident',
    ],
  },
];

// --- Survey Components ---

const WelcomeScreen = ({ onStart }) => (
  <div className="text-center">
    <h1 className="text-3xl md:text-4xl font-bold text-gray-800 mb-4">AI in Your Family's Life</h1>
    <p className="text-gray-600 mb-8 max-w-2xl mx-auto">
      Welcome! This quick, anonymous survey will help us understand our shared experiences with AI. Your answers will help guide our conversation today.
    </p>
    <button
      onClick={onStart}
      className="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-transform transform hover:scale-105 shadow-lg"
    >
      Start Survey
    </button>
  </div>
);

const ResultsScreen = ({ answers, onRestart }) => {
    const getAnswerDisplay = (question, answer) => {
        if (!answer || (Array.isArray(answer) && answer.length === 0)) {
            return <span className="text-gray-500 italic">No answer</span>;
        }
        if (question.type === 'checkbox') {
            return (
                <ul className="list-disc list-inside">
                    {answer.map((item, index) => <li key={index}>{item}</li>)}
                </ul>
            );
        }
        return <p className="text-blue-700 font-medium">{answer}</p>;
    };

    return (
        <div className="text-center">
            <h1 className="text-3xl md:text-4xl font-bold text-gray-800 mb-4">Thank You!</h1>
            <p className="text-gray-600 mb-8 max-w-2xl mx-auto">
                Your responses are valuable. This gives us a great starting point for our discussion on how we can partner to guide our children in the age of AI.
            </p>
            <div className="bg-white rounded-xl shadow-md p-6 md:p-8 text-left w-full max-w-3xl mx-auto border border-gray-200">
                <h2 className="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">Your Survey Summary</h2>
                <div className="space-y-6">
                    {surveyQuestions.map(q => (
                        <div key={q.id}>
                            <p className="font-semibold text-gray-700 mb-2">{q.question}</p>
                            {getAnswerDisplay(q, answers[q.id])}
                        </div>
                    ))}
                </div>
            </div>
            <button
                onClick={onRestart}
                className="mt-8 bg-gray-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-gray-700 transition-transform transform hover:scale-105 shadow-lg"
            >
                Take Again
            </button>
        </div>
    );
};


const QuestionCard = ({ question, onAnswer, onBack, answer, isFirst, isLast }) => {
  const { id, type, question: questionText, options, placeholder } = question;

  const handleRadioChange = (option) => {
    onAnswer(id, option);
  };

  const handleCheckboxChange = (option) => {
    const currentAnswer = answer || [];
    let newAnswer;
    if (option === 'None of the above') {
        newAnswer = currentAnswer.includes(option) ? [] : [option];
    } else {
        const otherOptions = currentAnswer.filter(item => item !== 'None of the above');
        if (otherOptions.includes(option)) {
            newAnswer = otherOptions.filter(item => item !== option);
        } else {
            newAnswer = [...otherOptions, option];
        }
    }
    onAnswer(id, newAnswer);
  };

  const handleTextChange = (e) => {
    onAnswer(id, e.target.value);
  };
  
  const isNextDisabled = () => {
      if (type === 'checkbox') return !answer || answer.length === 0;
      return !answer;
  }

  return (
    <div className="bg-white rounded-xl shadow-lg p-6 md:p-10 w-full max-w-3xl border border-gray-100">
      <h2 className="text-xl md:text-2xl font-semibold text-gray-800 mb-6">{questionText}</h2>
      
      <div className="space-y-4 mb-8">
        {type === 'radio' && options.map((option) => (
          <label key={option} className="flex items-center p-4 rounded-lg border border-gray-200 cursor-pointer hover:bg-blue-50 transition-colors"
            onClick={() => handleRadioChange(option)}
          >
            {answer === option ? <RadioSelectedIcon className="text-blue-600 mr-4 flex-shrink-0" /> : <RadioIcon className="text-gray-400 mr-4 flex-shrink-0" />}
            <span className="text-gray-700">{option}</span>
          </label>
        ))}

        {type === 'checkbox' && options.map((option) => (
          <label key={option} className="flex items-center p-4 rounded-lg border border-gray-200 cursor-pointer hover:bg-blue-50 transition-colors"
            onClick={() => handleCheckboxChange(option)}
          >
            <div className={`w-6 h-6 mr-4 rounded border-2 flex-shrink-0 flex items-center justify-center ${answer?.includes(option) ? 'bg-blue-600 border-blue-600' : 'border-gray-300'}`}>
              {answer?.includes(option) && <CheckIcon className="text-white" />}
            </div>
            <span className="text-gray-700">{option}</span>
          </label>
        ))}

        {type === 'text' && (
          <textarea
            value={answer || ''}
            onChange={handleTextChange}
            placeholder={placeholder}
            rows="4"
            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
          />
        )}
      </div>

      <div className="flex justify-between items-center">
        <button
          onClick={onBack}
          disabled={isFirst}
          className="bg-gray-200 text-gray-700 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 transition disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Back
        </button>
        <button
          onClick={() => onAnswer(id, answer, true)} // Special flag to move to next
          disabled={isNextDisabled()}
          className="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition shadow-md disabled:bg-blue-300 disabled:cursor-not-allowed"
        >
          {isLast ? 'Finish' : 'Next'}
        </button>
      </div>
    </div>
  );
};


// --- Main App Component ---

export default function App() {
  const [surveyState, setSurveyState] = useState('welcome'); // 'welcome', 'in_progress', 'results'
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [answers, setAnswers] = useState({});
  
  const currentQuestion = surveyQuestions[currentQuestionIndex];
  const totalQuestions = surveyQuestions.length;

  const handleStart = () => {
    setSurveyState('in_progress');
  };

  const handleAnswer = (questionId, answer, isNextPressed = false) => {
    const newAnswers = { ...answers, [questionId]: answer };
    setAnswers(newAnswers);

    if (isNextPressed) {
      if (currentQuestionIndex < totalQuestions - 1) {
        setCurrentQuestionIndex(currentQuestionIndex + 1);
      } else {
        setSurveyState('results');
      }
    }
  };

  const handleBack = () => {
    if (currentQuestionIndex > 0) {
      setCurrentQuestionIndex(currentQuestionIndex - 1);
    }
  };

  const handleRestart = () => {
    setAnswers({});
    setCurrentQuestionIndex(0);
    setSurveyState('welcome');
  };

  const progress = useMemo(() => {
    if (surveyState !== 'in_progress') return 0;
    return ((currentQuestionIndex) / totalQuestions) * 100;
  }, [currentQuestionIndex, totalQuestions, surveyState]);


  return (
    <main className="bg-gray-50 font-sans min-h-screen w-full flex flex-col items-center justify-center p-4 transition-all duration-500">
        <div className="w-full max-w-3xl mx-auto">
            {surveyState === 'in_progress' && (
                <div className="mb-4">
                    <div className="flex justify-between items-center mb-2">
                        <span className="text-sm font-semibold text-blue-800">Question {currentQuestionIndex + 1} of {totalQuestions}</span>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-2.5">
                        <div className="bg-blue-600 h-2.5 rounded-full transition-all duration-500" style={{ width: `${progress}%` }}></div>
                    </div>
                </div>
            )}

            <div className="transition-opacity duration-300 ease-in-out">
                {surveyState === 'welcome' && <WelcomeScreen onStart={handleStart} />}
                {surveyState === 'in_progress' && (
                    <QuestionCard
                        key={currentQuestion.id}
                        question={currentQuestion}
                        answer={answers[currentQuestion.id]}
                        onAnswer={handleAnswer}
                        onBack={handleBack}
                        isFirst={currentQuestionIndex === 0}
                        isLast={currentQuestionIndex === totalQuestions - 1}
                    />
                )}
                {surveyState === 'results' && <ResultsScreen answers={answers} onRestart={handleRestart} />}
            </div>
        </div>

        <footer className="text-center text-gray-500 text-sm mt-8">
            <p>An interactive tool for the AI for Families session.</p>
        </footer>
    </main>
  );
}


 
